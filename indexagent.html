<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="./style.css" />
		<title>Agent Test Environment</title>

	</head>

	<body>
		<div id="div1"></div>
		

		
		<!-- Game Info Display - Plain Text -->
		<div id="losUI">
			Agent Test Environment
			<button id="resetButton" onclick="window.location.reload()">Reset Scene</button>
			<div id="agentScores">Loading scores...</div>
			<div id="testTimer">Timer: 0</div>
			<div>
				Free-roam camera controls<br>
				Mouse: Look around<br>
				Scroll: Zoom in/out
			</div>
		</div>

		<!-- DQN Training Controls -->
		<div id="dqn-controls" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;">
			<h3>DQN Training System - Phase 1</h3>
			<div>
				<strong>Current Mode:</strong> <span id="current-mode">Random</span>
			</div>
			<div style="margin-top: 10px;">
				<button id="start-training">Start Data Collection</button>
				<button id="stop-training">Stop Collection</button>
				<button id="export-data">Export Training Data</button>
			</div>
			<div style="margin-top: 10px;">
				<div>Experiences Collected: <span id="experience-count">0</span></div>
				<div>Collection Status: <span id="collection-status">Stopped</span></div>
			</div>
		</div>
		
		<script>
			// Simple timer to show the page is working
			let timerCount = 0;
			setInterval(() => {
				timerCount++;
				const timerDiv = document.getElementById('testTimer');
				if (timerDiv) {
					timerDiv.textContent = `Timer: ${timerCount} (${new Date().toLocaleTimeString()})`;
				}
			}, 1000);
		</script>
		

		
	<script type="importmap">
		{
			"imports": {
				"three": "https://unpkg.com/three@0.161.0/build/three.module.js",
				"three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
			}
		}
	</script>

	<script type="module">
		import * as THREE from 'three';
		import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
		import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
		import { DQNDataCollector } from './dqn_system.js';
		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		import { CriticalPointSystem, CP_COLORS } from './critical-point-system.js';
		
		// Expose Three.js and related systems to global scope (exactly like indexjake.html)
		window.THREE = THREE;
		window.OBJLoader = OBJLoader;
		window.MTLLoader = MTLLoader;
		window.CriticalPointSystem = CriticalPointSystem;
		window.CP_COLORS = CP_COLORS;
		
		// Initialize DQN Data Collection System
		const dqnDataCollector = new DQNDataCollector();
		window.dqnDataCollector = dqnDataCollector;
		
		// DQN UI Controls
		document.addEventListener('DOMContentLoaded', () => {
			const startBtn = document.getElementById('start-training');
			const stopBtn = document.getElementById('stop-training');
			const exportBtn = document.getElementById('export-data');
			const modeSpan = document.getElementById('current-mode');
			const expCountSpan = document.getElementById('experience-count');
			const statusSpan = document.getElementById('collection-status');
			
			// Start data collection
			startBtn.onclick = () => {
				if (window.gameManager) {
					window.gameManager.setAllAgentsMode('training', dqnDataCollector);
					dqnDataCollector.startCollection();
					modeSpan.textContent = 'Training (Data Collection)';
					statusSpan.textContent = 'Collecting...';
				}
			};
			
			// Stop data collection
			stopBtn.onclick = () => {
				if (window.gameManager) {
					window.gameManager.setAllAgentsMode('random');
					dqnDataCollector.stopCollection();
					modeSpan.textContent = 'Random';
					statusSpan.textContent = 'Stopped';
				}
			};
			
			// Export training data
			exportBtn.onclick = () => {
				dqnDataCollector.exportTrainingData();
			};
			
			// Update UI every second
			setInterval(() => {
				const stats = dqnDataCollector.getStats();
				expCountSpan.textContent = stats.experienceCount;
			}, 1000);
		});
		
		console.log('Three.js, loaders, Critical Point System, and DQN system loaded successfully');
	</script>

	<script src="AgentTestMain.js" type="module" defer></script>
	</body>
</html>
