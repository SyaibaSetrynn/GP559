<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Expires" content="0">
		<link rel="stylesheet" href="./style.css" />
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			
			body {
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
				background-color: #1a1a1a;
				font-family: Arial, sans-serif;
			}
			
			#gameContainer {
				position: relative;
			}
			
			#gameCanvas {
				display: block;
				border: 2px solid #333;
				background-color: transparent;
				position: relative;
				z-index: 2;
			}
			
			#div1 {
				display: none;
			}
			
			#menuOverlay {
				display: none;
			}
			
			#losUI {
				position: absolute; 
				top: 10px; 
				right: 420px; 
				color: white; 
				font-family: monospace; 
				font-size: 14px; 
				font-weight: bold; 
				text-align: right; 
				text-shadow: 2px 2px 4px rgba(0,0,0,0.8); 
				display: none; 
				pointer-events: none;
			}
		</style>
	</head>

	<body>
		<!-- START GAME BUTTON - Always visible for testing -->
		<button id="skipToGame" style="position: fixed; top: 10px; left: 10px; z-index: 10000; padding: 15px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;">
			ðŸŽ® START GAME NOW
		</button>
		
		<div id="gameContainer">
			<canvas id="gameCanvas" width="1280" height="720"></canvas>
		</div>
		
		<div id="div1"></div>
		<div id="menuOverlay">
			<div id="startText">Click to Start</div>
		</div>
		
		<div id="losUI">
			<div id="agentScores">Loading scores...</div>
		</div>
		
	<script type="importmap">
		{
			"imports": {
				"three": "https://unpkg.com/three@0.161.0/build/three.module.js",
				"three/addons/": "https://unpkg.com/three@0.161.0/examples/jsm/"
			}
		}
	</script>

	<script type="module">
		import * as THREE from 'three';
		import { OBJLoader } from 'three/addons/loaders/OBJLoader.js';
		import { MTLLoader } from 'three/addons/loaders/MTLLoader.js';
		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		import { Octree } from 'three/addons/math/Octree.js';
		import { OctreeHelper } from 'three/addons/helpers/OctreeHelper.js';
		import { Capsule } from 'three/addons/math/Capsule.js';
		import { CriticalPointSystem, CP_COLORS } from './critical-point-system.js';
		
		const AgentModule = await import('./Agent.js');
		const AgentManagerModule = await import('./AgentManager.js');
		
		// Expose to global scope
		window.THREE = THREE;
		window.T = THREE;
		window.OBJLoader = OBJLoader;
		window.MTLLoader = MTLLoader;
		window.OrbitControls = OrbitControls;
		window.Octree = Octree;
		window.OctreeHelper = OctreeHelper;
		window.Capsule = Capsule;
		window.CriticalPointSystem = CriticalPointSystem;
		window.CP_COLORS = CP_COLORS;
		window.Agent = AgentModule.default;
		window.AgentManager = AgentManagerModule.default;
		
		window.PLAYER_HEIGHT = 0.5;
		window.PLAYER_RADIUS = 0.5 * Math.sqrt(2) / 2;
		window.PLAYER_SPEED = 0.02;
		window.PLAYER_JUMP_HEIGHT = 1.2;
		window.PLAYER_JUMP_SPEED = 0.03;
		window.WORLD_BOUNDARY = 20;
		window.GRAVITY = (window.PLAYER_JUMP_SPEED * window.PLAYER_JUMP_SPEED) / (2 * window.PLAYER_JUMP_HEIGHT);
		
		console.log('âœ“ Dependencies loaded');
		
		// Start game function
		function startGameNow(level = 1) {
			console.log('========================================');
			console.log(`STARTING GAME for level ${level}`);
			console.log('========================================');
			
			// Hide UI
			const skipBtn = document.getElementById('skipToGame');
			const gameCanvas = document.getElementById('gameCanvas');
			const gameContainer = document.getElementById('gameContainer');
			const menuOverlay = document.getElementById('menuOverlay');
			
			if (skipBtn) skipBtn.style.display = 'none';
			if (gameCanvas) gameCanvas.style.display = 'none';
			if (gameContainer) gameContainer.style.display = 'none';
			if (menuOverlay) menuOverlay.style.display = 'none';
			
			// Show game container
			const div1 = document.getElementById('div1');
			if (div1) {
				div1.style.display = 'block';
				div1.style.position = 'fixed';
				div1.style.top = '0';
				div1.style.left = '0';
				div1.style.width = '100vw';
				div1.style.height = '100vh';
				div1.style.zIndex = '9999';
			}
			
			const losUI = document.getElementById('losUI');
			if (losUI) losUI.style.display = 'block';
			
			// Start game
			if (window.startIndexJakeGame) {
				console.log('âœ“ Calling startIndexJakeGame...');
				window.startIndexJakeGame(level);
			} else {
				console.error('âœ— startIndexJakeGame not found!');
			}
		}
		
		// Make globally accessible
		window.startGameNow = startGameNow;
		
		// Button click handler
		document.getElementById('skipToGame').addEventListener('click', () => {
			console.log('Button clicked!');
			startGameNow(1);
		});
		
		console.log('âœ“ Setup complete - Click the button to start!');
	</script>

	<script src="StateManager.js"></script>
	<script src="Player.js" type="module"></script>
	<script src="LevelContent3D.js" defer></script>
	<script src="LevelSelection3D.js" defer></script>
	<script src="UI.js"></script>
	</body>
</html>
